services:
  postgresql:
    build: docker/postgresql
    volumes:
      - postgresql_bazafirm:/var/lib/postgresql/data/
    environment:
      POSTGRES_DB: bazafirm
      POSTGRES_USER: bazafirm
      POSTGRES_PASSWORD: bazafirm
    ports:
      - "15432:5432"

  minio:
    image: docker.io/bitnami/minio:2021
    environment:
      MINIO_ROOT_USER: minio
      MINIO_ROOT_PASSWORD: minio123
    ports:
      - '9000:9000'
      - '9001:9001'
    volumes:
      - 'minio_data:/data'

  baza_firm:
    build: docker/baza_firm
    container_name: baza_firm
    depends_on:
      - postgresql
      - minio
    environment:
      DEPLOY_ENV: test
      CEIDG_PATH: https://dane.biznes.gov.pl/api/ceidg/v2
      CEIDG_TOKEN: eyJraWQiOiJjZWlkZyIsImFsZyI6IkhTNTEyIn0.eyJnaXZlbl9uYW1lIjoiVmFkeW0iLCJwZXNlbCI6IjkwMTAxMDE1OTE5IiwiaWF0IjoxNzM5NzkzNzQ4LCJmYW1pbHlfbmFtZSI6Iktvcm9sb3YiLCJjbGllbnRfaWQiOiJVU0VSLTkwMTAxMDE1OTE5LVZBRFlNLUtPUk9MT1YifQ.CsAz45KpS--N3rG4hLDgMEtpbr-SSz7nhnyRwws25Fh9YcJYTi3lWuU_rQpUlHzUDwObU9u7k3RFRMALb5-mMw
      SPRING_DATASOURCE_URL: jdbc:postgresql://postgresql:5432/bazafirm
      SPRING_DATASOURCE_USERNAME: bazafirm
      SPRING_DATASOURCE_PASSWORD: bazafirm
      AWS_ACCESS_KEY: minio
      AWS_SECRET_KEY: minio123
      AWS_ENDPOINT: http://minio:9000
      TEMP_DIR_PATH: /tmp/bazafirm/

    ports:
      - "18080:8080"

volumes:
  minio_data:
    driver: local
  postgresql_bazafirm:
